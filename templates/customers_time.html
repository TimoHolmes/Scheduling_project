<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book an Appointment</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-orange-500 to-purple-600 min-h-screen p-3 sm:p-4">

    <!-- Top Bar -->
    <div class="max-w-2xl mx-auto flex items-center justify-between mb-4 sm:mb-6 pt-2 gap-2">
        <div class="flex items-center space-x-2 min-w-0">
            <div class="bg-white w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center">
                <svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
            </div>
            <span class="text-white font-bold text-base sm:text-lg truncate">Book an Appointment</span>
        </div>
        <a href="sign_in_page.html" class="text-white hover:text-orange-200 text-sm font-medium transition-colors flex-shrink-0">Sign Out</a>
    </div>

    <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-4 sm:p-8">
        <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-1">Available Time Slots</h2>
        <p class="text-gray-500 text-sm mb-6">Pick a day and time that works for you.</p>

        <!-- Available slots listed by day -->
        <div id="slotList" class="space-y-6">
            <!-- Generated by JS -->
        </div>

        <!-- No availability message -->
        <div id="noSlots" class="hidden text-center py-10">
            <p class="text-gray-400 text-lg">No available times right now. Check back later!</p>
        </div>

        <!-- Booking confirmation (hidden by default) -->
        <div id="confirmationMessage" class="hidden mt-6 bg-green-100 text-green-700 text-sm font-medium p-4 rounded-lg text-center">
            ✅ You're booked! See you then.
        </div>
    </div>

    <script>
        const dayNames = {
            mon: 'Monday', tue: 'Tuesday', wed: 'Wednesday',
            thu: 'Thursday', fri: 'Friday', sat: 'Saturday', sun: 'Sunday'
        };
        const slotLabels = {
            '08-10': '8:00 – 10:00 AM',
            '10-12': '10:00 AM – 12:00 PM',
            '12-14': '12:00 – 2:00 PM',
            '14-16': '2:00 – 4:00 PM',
            '16-18': '4:00 – 6:00 PM',
            '18-20': '6:00 – 8:00 PM',
        };

        const availability = JSON.parse(localStorage.getItem('ownerAvailability') || '{}');
        const booked = JSON.parse(localStorage.getItem('bookedSlots') || '[]');
        const slotList = document.getElementById('slotList');
        const noSlots = document.getElementById('noSlots');

        // Group available slots by day
        const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
        let hasAny = false;

        days.forEach(day => {
            const daySlots = Object.keys(availability).filter(id =>
                id.startsWith(day + '_') && availability[id] && !booked.includes(id)
            );

            if (daySlots.length === 0) return;
            hasAny = true;

            const section = document.createElement('div');

            const heading = document.createElement('h3');
            heading.className = 'text-lg font-semibold text-gray-800 mb-3';
            heading.textContent = dayNames[day];
            section.appendChild(heading);

            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-1 sm:grid-cols-2 gap-3';

            daySlots.forEach(id => {
                const timeKey = id.split('_')[1];
                const btn = document.createElement('button');
                btn.className = 'border-2 border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 text-sm';
                btn.textContent = slotLabels[timeKey];
                btn.addEventListener('click', () => bookSlot(id, btn));
                grid.appendChild(btn);
            });

            section.appendChild(grid);
            slotList.appendChild(section);
        });

        if (!hasAny) {
            noSlots.classList.remove('hidden');
        }

        function bookSlot(id, btn) {
            if (!confirm('Book this time slot?\n\n' + dayNames[id.split('_')[0]] + ' — ' + slotLabels[id.split('_')[1]])) return;

            // Save booking
            const bookings = JSON.parse(localStorage.getItem('bookedSlots') || '[]');
            bookings.push(id);
            localStorage.setItem('bookedSlots', JSON.stringify(bookings));

            // Disable the button
            btn.disabled = true;
            btn.className = 'bg-gray-200 text-gray-400 font-semibold py-3 px-4 rounded-lg text-sm cursor-not-allowed';
            btn.textContent += ' (Booked)';

            // Show confirmation
            const msg = document.getElementById('confirmationMessage');
            msg.classList.remove('hidden');
            setTimeout(() => msg.classList.add('hidden'), 3000);
        }
    </script>

</body>
</html>